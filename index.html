<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Matek J√°t√©k</title>
  <meta name="theme-color" content="#4CAF50">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <style>
    *, *::before, *::after { box-sizing: border-box; }

    html, body { height: 100%; margin: 0; padding: 0; overflow-x: hidden; }

    body {
      font-family: Arial, sans-serif;
      background: url('https://picsum.photos/1200/800?blur=3') no-repeat center center fixed;
      background-size: cover;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      display: flex;
      flex-direction: column;
      max-width: 1200px;
      width: 90%;
      background: rgba(255,255,255,0.9);
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      padding: 15px;
      gap: 20px;
    }

    @media (min-width: 900px) {
      .container { flex-direction: row; align-items: flex-start; }
    }

    .game { flex: 3; text-align: center; padding: 10px; }
    .sidebar{ flex: 1; display: flex; flex-direction: column; gap: 15px; }
    .multiplication, .conversion{ background:#fff; padding:10px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.15); }

    h1 { color: #222; text-shadow: 1px 1px 2px #fff; font-size: 1.6em; margin: 8px 0; }
    h2 { margin: 6px 0 10px; font-size: 1.1em; }
    .row { display: flex; gap: 8px; justify-content: center; align-items: center; flex-wrap: wrap; margin: 6px 0; }
    .question { font-size: 22px; margin: 15px 0; font-weight: bold; color: #333; }
    #emoji { font-size: 40px; animation: bounce 1s infinite; }
    @keyframes bounce { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-10px);} }
    input, select { font-size: 18px; padding: 6px; text-align: center; margin: 5px; border-radius: 6px; border: 1px solid #ccc; width: 80%; max-width: 240px; }
    button { font-size: 18px; padding: 10px; margin: 5px; border: none; border-radius: 8px; cursor: pointer; transition: 0.3s; width: 80%; max-width: 250px; }
    button:hover { transform: scale(1.05); }
    #startBtn{ background-color:#4CAF50; color:white; }
    #answerBtn{ background-color:#2196F3; color:white; }
    #timer{ font-size: 18px; margin: 10px; color: #444; }
    #result{ font-size: 20px; margin-top: 10px; font-weight: bold; }
    #progressBarContainer{ width:80%; background:#ddd; border-radius:10px; margin:10px auto; height:20px; overflow:hidden; }
    #progressBar{ height:20px; background:#4CAF50; width:0%; border-radius:10px; transition: width .2s ease; }
    table{ width:100%; border-collapse:collapse; margin-top:10px; font-size:14px; }
    th,td{ padding:4px; text-align:center; border:1px solid #bbb; }
    th{ background-color:#f7f7f7; }
    .hidden{ display:none; }
    .ok{ color:#1a7f37; font-size:20px; }
    .bad{ color:#d1242f; font-size:20px; }

    .conv-field{ display:flex; align-items:center; justify-content:space-between; gap:8px; margin:8px 0; }
    .conv-field label{ flex:0 0 auto; font-size:15px; color:#333; }
    .conv-field .conv-input-wrap{ display:flex; align-items:center; gap:6px; flex:1; justify-content:flex-end; }
    .conv-field input{ width:120px; max-width:100%; margin:0; }
    .conv-field .unit{ min-width:1.5em; text-align:left; color:#555; }

    #confettiCanvas{ position:fixed; inset:0; width:100%; height:100%; pointer-events:none; }

    /* Mobil */
    @media (max-width: 767px) {
      body { background:#fff; display:block; overflow-x:hidden; }
      .container { box-shadow:none; border-radius:0; background:#fff; padding:8px; width:100%; gap:12px; }
      h1 { font-size:1.3em; margin:0 0 6px 0; }
      .question { font-size:20px; }
      input, select, button { width:100%; max-width:none; font-size:16px; }
      #progressBarContainer { width:100%; margin:10px 0; }
      .multiplication table, #summary table { display:block; overflow-x:auto; -webkit-overflow-scrolling:touch; }
      .conv-field { gap:10px; }
      .conv-field input { width:100%; }
      .conv-field .conv-input-wrap { justify-content:flex-start; }
    }

    /* Tablet (iPad) */
    @media (min-width:768px) and (max-width:1024px) {
      body { background:#fff; display:flex; justify-content:center; align-items:flex-start; padding:20px; }
      .container { flex-direction:column; width:95%; max-width:900px; box-shadow:0 0 12px rgba(0,0,0,0.15); border-radius:10px; padding:20px; background:#fafafa; }
      h1 { font-size:1.5em; margin:5px 0 10px 0; }
      .question { font-size:22px; }
      input, select, button { font-size:17px; width:100%; max-width:350px; }
      .multiplication, .conversion { width:100%; margin:0 auto; }
      .conversion input { width:140px; }
    }
  </style>
</head>
<body>
  <canvas id="confettiCanvas"></canvas>
  <div class="container">
    <div class="game">
      <h1>üéØ Matek J√°t√©k üéØ</h1>

      <div class="row">
        <label for="playerName">N√©v:</label>
        <input type="text" id="playerName" placeholder="Add meg a neved">
      </div>

      <div class="row">
        <label for="difficulty">Neh√©zs√©g:</label>
        <select id="difficulty">
          <option value="easy">K√∂nny≈±</option>
          <option value="medium">K√∂zepes</option>
          <option value="hard">Neh√©z</option>
        </select>
      </div>

      <div class="row">
        <label for="operation">M≈±velet:</label>
        <select id="operation" onchange="toggleMulControls()">
          <option value="mix">√ñsszes vegyesen</option>
          <option value="+">√ñsszead√°s</option>
          <option value="-">Kivon√°s</option>
          <option value="*">Szorz√°s</option>
          <option value="/">Oszt√°s</option>
        </select>
      </div>

      <!-- √öJ: Szorz√≥t√°bla m√≥d -->
      <div class="row" id="mulControls">
        <label for="mulMode">Szorz√≥t√°bla m√≥d:</label>
        <select id="mulMode" onchange="toggleMulControls()">
          <option value="random">Random</option>
          <option value="fixed">Kiv√°lasztott</option>
        </select>

        <label for="mulTable">T√°bla:</label>
        <select id="mulTable">
          <!-- 1‚Äì12-ig; ha szeretn√©d, emelhetem 20-ig -->
          <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option>
          <option>7</option><option>8</option><option>9</option><option selected>10</option><option>11</option><option>12</option>
        </select>
      </div>

      <div class="row">
        <label for="questionSet">Feladatok sz√°ma:</label>
        <select id="questionSet" onchange="toggleCustomCount()">
          <option value="10">10</option>
          <option value="20">20</option>
          <option value="custom">Saj√°t</option>
        </select>
        <input type="number" id="customCount" class="hidden" min="1" max="100" value="10" placeholder="pl. 15">
      </div>

      <div class="question" id="question">Nyomd meg a START gombot!</div>
      <div id="emoji"></div>
      <input type="number" id="answer" placeholder="V√°lasz">
      <br>
      <div id="progressBarContainer"><div id="progressBar"></div></div>
      <button id="startBtn" onclick="startGame()">üöÄ START</button>
      <button id="answerBtn" onclick="checkAnswer()">‚úÖ V√°lasz elk√ºld√©se</button>
      <div id="timer"></div>
      <div id="result"></div>
      <div id="summary"></div>
      <div id="badge"></div>
      <div id="highScore"></div>
    </div>

    <div class="sidebar">
      <div class="multiplication">
        <h2>üìñ Szorz√≥t√°bla</h2>
        <table id="table"></table>
      </div>

      <div class="conversion">
        <h2>üìê ≈∞rm√©rt√©k √°tv√°lt√°s</h2>
        <div class="conv-field">
          <label for="liters">Liter</label>
          <div class="conv-input-wrap">
            <input type="number" id="liters" placeholder="Liter" oninput="convertVolume('liters')">
            <span class="unit">L</span>
          </div>
        </div>
        <div class="conv-field">
          <label for="milliliters">Milliliter</label>
          <div class="conv-input-wrap">
            <input type="number" id="milliliters" placeholder="Milliliter" oninput="convertVolume('milliliters')">
            <span class="unit">ml</span>
          </div>
        </div>
        <div class="conv-field">
          <label for="deciliters">Deciliter</label>
          <div class="conv-input-wrap">
            <input type="number" id="deciliters" placeholder="Deciliter" oninput="convertVolume('deciliters')">
            <span class="unit">dl</span>
          </div>
        </div>
      </div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<script>
let correctAnswer=0,timeLimit=0,timerInterval,questionIndex=0,score=0,answers=[],currentQuestion=null,totalQuestions=10,playerName="J√°t√©kos";

function toggleCustomCount(){
  const sel=document.getElementById("questionSet").value;
  const input=document.getElementById("customCount");
  if(sel==="custom"){ input.classList.remove("hidden"); } else { input.classList.add("hidden"); }
}

// √öJ: a szorz√≥t√°bla vez√©rl≈ëk enged√©lyez√©se/tilt√°sa
function toggleMulControls(){
  const op = document.getElementById("operation").value;
  const mulControls = document.getElementById("mulControls");
  const mulMode = document.getElementById("mulMode");
  const mulTable = document.getElementById("mulTable");
  const isMul = (op === "*");
  mulControls.style.opacity = isMul ? "1" : "0.5";
  mulControls.style.pointerEvents = isMul ? "auto" : "none";
  mulMode.disabled = !isMul;
  mulTable.disabled = !isMul || (mulMode.value !== "fixed");
}
toggleMulControls();

function playSound(correct){
  const url = correct ? "https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" : "https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg";
  try { new Audio(url).play().catch(()=>{}); } catch(_) {}
}

function showConfetti(){
  if (typeof confetti === 'function') {
    confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
  }
}

function updateProgress(){
  const pct = totalQuestions>0 ? (score/totalQuestions)*100 : 0;
  document.getElementById("progressBar").style.width = pct + "%";
}

function getHighScoreKey(){ return "highScore_" + (playerName || "J√°t√©kos"); }

function updateHighScore(){
  let best=Number(localStorage.getItem(getHighScoreKey()))||0;
  if(score>best){ best=score; localStorage.setItem(getHighScoreKey(),best); }
  document.getElementById("highScore").textContent="üèÖ Legjobb pontsz√°mod ("+playerName+"): "+best+"/"+totalQuestions;
}

function createTable(){
  let html="<tr><th>x</th>";
  for(let j=1;j<=10;j++) html+=`<th>${j}</th>`;
  html+="</tr>";
  for(let i=1;i<=10;i++){
    html+=`<tr><th>${i}</th>`;
    for(let j=1;j<=10;j++) html+=`<td>${i}√ó${j}=${i*j}</td>`;
    html+="</tr>";
  }
  document.getElementById("table").innerHTML=html;
}

function convertVolume(c){
  let l=parseFloat(document.getElementById("liters").value)||0,
      ml=parseFloat(document.getElementById("milliliters").value)||0,
      dl=parseFloat(document.getElementById("deciliters").value)||0;
  if(c==="liters"){document.getElementById("milliliters").value=l*1000;document.getElementById("deciliters").value=l*10;}
  else if(c==="milliliters"){document.getElementById("liters").value=ml/1000;document.getElementById("deciliters").value=ml/100;}
  else if(c==="deciliters"){document.getElementById("liters").value=dl/10;document.getElementById("milliliters").value=dl*100;}
}

function startGame(){
  const nameInput = (document.getElementById("playerName").value || "").trim();
  playerName = nameInput.length ? nameInput : "J√°t√©kos";

  const setVal = document.getElementById("questionSet").value;
  totalQuestions = (setVal==="custom")
      ? Math.max(1, Math.min(100, parseInt(document.getElementById("customCount").value)||10))
      : parseInt(setVal);

  questionIndex=0; score=0; answers=[];
  document.getElementById("summary").innerHTML="";
  document.getElementById("badge").innerHTML="";
  document.getElementById("emoji").textContent="";
  document.getElementById("result").textContent="";
  updateProgress();
  newQuestion();
}

function newQuestion(){
  if(questionIndex>=totalQuestions){ endGame(); return; }

  const selectedOp=document.getElementById("operation").value;
  let op=selectedOp==="mix"?["+","-","*","/"][Math.floor(Math.random()*4)]:selectedOp;

  const difficulty=document.getElementById("difficulty").value;
  let max=10; if(difficulty==="medium") max=20; if(difficulty==="hard") max=50;

  let a,b,displayA,displayB;

  if(op==="/"){
    // Eg√©sz oszt√°s: (a*b) √∑ a = b
    a = Math.floor(Math.random()*max)+1;   // oszt√≥
    b = Math.floor(Math.random()*max)+1;   // h√°nyados
    displayA = a*b;                        // osztand√≥
    displayB = a;                          // oszt√≥
    correctAnswer = b;
  } else if(op==="*"){
    const isMulModeActive = (document.getElementById("operation").value==="*");
    const mulMode = document.getElementById("mulMode").value;
    const fixedN = parseInt(document.getElementById("mulTable").value)||10;

    if(isMulModeActive && mulMode==="fixed"){
      // Kiv√°lasztott t√°bla: egyik t√©nyez≈ë fix (a sorrendet v√©letlen√≠tj√ºk a v√°ltozatoss√°g kedv√©√©rt)
      const rand = Math.floor(Math.random()*max)+1;
      if(Math.random()<0.5){ a = fixedN; b = rand; } else { a = rand; b = fixedN; }
    } else {
      // Random szorz√°s
      a = Math.floor(Math.random()*max)+1;
      b = Math.floor(Math.random()*max)+1;
    }
    correctAnswer = a*b;
    displayA = a; displayB = b;
  } else {
    // + vagy -
    a = Math.floor(Math.random()*max)+1;
    b = Math.floor(Math.random()*max)+1;
    if(op==="-"){ while(b>a) b=Math.floor(Math.random()*max)+1; }
    correctAnswer = op==="+"?a+b:a-b;
    displayA = a; displayB = b;
  }

  document.getElementById("question").textContent=`${questionIndex+1}. Mennyi ${displayA} ${op} ${displayB}?`;
  document.getElementById("result").textContent="";
  document.getElementById("answer").value="";
  timeLimit=Math.floor(Math.random()*31)+30;
  startTimer();
  questionIndex++;
  currentQuestion={a:displayA,b:displayB,op,correct:correctAnswer};
}

function startTimer(){
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    document.getElementById("timer").textContent=`H√°tral√©v≈ë id≈ë: ${timeLimit} mp`;
    if(timeLimit<=0){
      clearInterval(timerInterval);
      answers.push({...currentQuestion,user:"-", helyes:false});
      setTimeout(newQuestion,800);
    }
    timeLimit--;
  },1000);
}

function checkAnswer(){
  const input = document.getElementById("answer").value;
  const valasz = Number.isFinite(parseFloat(input)) ? parseInt(input) : NaN;
  if(isNaN(valasz)){ document.getElementById("result").textContent="√çrj be egy eg√©sz sz√°mot!"; return; }

  const helyes = valasz===correctAnswer;
  if(helyes){
    const praises=[
      `√úgyes vagy, ${playerName}!`,`Nagyon sz√©p munka, ${playerName}!`,`Zseni√°lis volt, ${playerName}!`,
      `Szuper √ºgyes vagy, ${playerName}!`,`Fantasztikus teljes√≠tm√©ny, ${playerName}!`,`Csillagos √∂t√∂s, ${playerName}!`
    ];
    document.getElementById("result").textContent=praises[Math.floor(Math.random()*praises.length)];
    document.getElementById("emoji").textContent="‚úÖ";
    playSound(true); showConfetti(); score++;
  } else {
    document.getElementById("result").textContent=`Ez most nem siker√ºlt, ${playerName}. Helyes v√°lasz: ${currentQuestion.correct}`;
    document.getElementById("emoji").textContent="‚ùå"; playSound(false);
  }

  updateProgress();
  clearInterval(timerInterval);
  answers.push({...currentQuestion,user:valasz, helyes});
  setTimeout(newQuestion,1200);
}

function endGame(){
  let html=`<h2>üéâ J√°t√©k v√©ge! üéâ</h2><p><strong>Pontsz√°mod:</strong> ${score}/${totalQuestions}</p>`;
  if(score===totalQuestions){ document.getElementById("badge").innerHTML="üèÜ Matek bajnok!"; }
  updateHighScore();
  html+="<table><tr><th>#</th><th>Feladat</th><th>Helyes v√°lasz</th><th>Te v√°laszod</th><th>√ârt√©kel√©s</th></tr>";
  answers.forEach((q,idx)=>{
    const mark = q.helyes ? `<span class='ok'>‚úÖ</span>` : `<span class='bad'>‚ùå</span>`;
    html+=`<tr>
      <td>${idx+1}</td>
      <td>${q.a} ${q.op} ${q.b}</td>
      <td>${q.correct}</td>
      <td>${q.user}</td>
      <td>${mark}</td>
    </tr>`;
  });
  html+="</table>";
  document.getElementById("summary").innerHTML=html;
  document.getElementById("question").textContent="J√°t√©k v√©ge!";
}

// PWA regisztr√°ci√≥
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js', {scope:'./'}).catch(err => console.log('SW reg error:', err));
  });
}

createTable();
</script>
</body>
</html>
